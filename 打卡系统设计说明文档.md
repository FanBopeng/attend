##### 打卡系统设计说明文档

### 1.系统架构

 

​	![](E:\leap\attend\系统架构.png)

### 2.数据库设计



​	1.er图

 ![](E:\leap\attend\er图.jpg)

 	

​	2.表设计



​		1.Task表

  

| 字段           | 类型      | 备注                                       |
| -------------- | --------- | ------------------------------------------ |
| tid            | int       | 主键                                       |
| taskName       | varchar   | 任务名称                                   |
| beginTimeStart | timestamp | 会议开始打卡开始时间                       |
| endTimeStart   | timestamp | 会议结束打卡开始时间                       |
| createTime     | timestamp | 任务创建时间                               |
| status         | int       | 任务状态（-1 未开始 0.进行中，1.已经结束） |
| type           | varchar   | 任务类型                                   |
| address        | varchar   | 任务打卡地址                               |
| deleted        | int       | 删除标记位                                 |
| beginTimeover  | timestamp | 会议开始打卡开始时间                       |
| endTimeover    | timestamp | timestamp会以结束打卡结束时间              |

​	  2.employee 表

| 字段       | 类型      | 备注       |
| ---------- | --------- | ---------- |
| eid        | int       | 员工id     |
| ename      | varchar   | 员工姓名   |
| gender     | varchar   | 员工性别   |
| department | varchar   | 所属部门   |
| username   | varchar   | 用户名     |
| password   | varchar   | 密码       |
| email      | varchar   | 邮箱地址   |
| createTime | timestamp | 创建时间   |
| deleted    | int       | 删除标记位 |
| enumber    | int       | 工号       |

​	3.attend表

| 字段          | 类型      | 备注       |
| ------------- | --------- | ---------- |
| aid           | int       | 打卡记录id |
| empid         | int       | 员工id     |
| taskid        | int       | 任务id     |
| attendTime    | timestamp | 打卡时间   |
| attendAddress | varchar   | 打卡地址   |
| deleted       | int       | 状态标记位 |

​	4.attend_status表（分析打卡记录表最终生成对应的打卡状态）

| 字段       | 类型      | 备注                                              |
| ---------- | --------- | ------------------------------------------------- |
| asid       | int       | 打卡状态id                                        |
| empid      | int       | 员工id                                            |
| taskid     | int       | 任务id                                            |
| status     | int       | 状态（ 1.正常，2.早退，3.迟到，4.缺勤5.异地打卡） |
| createTime | timestamp | 创建                                              |
| deleted    | int       | 状态标记位                                        |

### 3.功能设计

	#### 1.登录模块

​	登录模块主要有登录和登出两个接口 

​		1.登录：	

| 请求方式 | post                                                         |
| :------: | ------------------------------------------------------------ |
|   url    | /user/login                                                  |
|   参数   | LoginVO                                                      |
|   说明   | 登录成功之后，生成一组token，保存到redis当中，返回给前端，后续访问系统资源都需要在请求头中携带token与redis当中的token串进行校验 |

​	         2.登出

| 请求方式 | delete                 |
| :------: | ---------------------- |
|   url    | /user/logout           |
|   参数   |                        |
|   说明   | 将redis当中的token删除 |

#### 2.任务模块

​	任务模块主要有以下几个接口	

​		1.获取打卡任务列表

| 请求方式 | get                      |
| :------: | ------------------------ |
|   url    | /task/list/{page}/{size} |
|   参数   | page  size               |
|   说明   | 分页获取当前任务的列表   |

​		2.创建打卡任务

| 请求方式 | post         |
| :------: | ------------ |
|   url    | /task/task   |
|   参数   | TaskVO       |
|   说明   | 创建打卡任务 |

​		3.根据状态获取打卡任务状态获取总数

| 请求方式 | get                                   |
| :------: | ------------------------------------- |
|   url    | /task/list/{page}/{size}/{status}     |
|   参数   | page,size,status                      |
|   说明   | -1打卡未开始，1打卡结束,0打卡正在进行 |

​	4.根据地址查询任务记录	

| 请求方式 | get                                |
| :------: | ---------------------------------- |
|   url    | /task/list/{page}/{size}/{address} |
|   参数   | page,size,address                  |
|   说明   | 根据指定地点查询打卡的任务列表     |

​	5.根据状态查询任务记录，并按照创建时间排序	

| 请求方式 | get                                      |
| :------: | ---------------------------------------- |
|   url    | /task/orderList/{page}/{size}/{status}   |
|   参数   | page,size,address                        |
|   说明   | 根据状态查询任务记录，并按照创建时间排序 |

​		6.根据任务创建用户查询

| 请求方式 | get                                             |
| :------: | ----------------------------------------------- |
|   url    | /task/createUserList/{page}/{size}/{createUser} |
|   参数   | page,size,createUser                            |
|   说明   | 根据任务创建用户查询任务列表                    |

​	7.更新任务状态

| 请求方式 | put                                                          |
| :------: | ------------------------------------------------------------ |
|   url    | /task/updateStatus                                           |
|   参数   |                                                              |
|   说明   | 任务创建之后 随着时间，任务的状态会改变。从未开始-进行中-结束 |

​	8.通过任务名称获取任务详细信息

| 请求方式 | get                          |
| :------: | ---------------------------- |
|   url    | /task/getTask/{taskName}     |
|   参数   | taskName                     |
|   说明   | 通过任务名称获取任务详细信息 |

​	9.通过任务名称删除任务

| 请求方式 | delete                |
| :------: | --------------------- |
|   url    | /task/{taskName}      |
|   参数   | taskName              |
|   说明   | 先删redis，再删数据库 |

#### 3.打卡模块

​     打卡模块主要分为以下几个接口

​	1.创建打卡记录

| 请求方式 | post                                     |
| :------: | ---------------------------------------- |
|   url    | /attend/attend                           |
|   参数   | AttendVO                                 |
|   说明   | 用户打卡之后再数据库中创建对应的打卡记录 |

​	2.根据任务展示对应的打卡记录

| 请求方式 | get                                           |
| :------: | --------------------------------------------- |
|   url    | /attend/taskAttend/{page}/{size}/{taskId}     |
|   参数   | page，size，taskId                            |
|   说明   | 根据任务展示打卡记录,并按照打卡的时间进行排序 |

​	3.根据任务展示对应的打卡记录

| 请求方式 | get                                           |
| :------: | --------------------------------------------- |
|   url    | /attend/userAttend/{enumber}/{page}/{size}    |
|   参数   | enumber,page，size                            |
|   说明   | 根据任务展示打卡记录,并按照打卡的时间进行排序 |

​	4.查看当前任务任然没有打卡的员工，以及未打卡员工总人数

| 请求方式 | get                                                  |
| :------: | ---------------------------------------------------- |
|   url    | /attend/taskNotAttend/{taskId}                       |
|   参数   | taskid                                               |
|   说明   | 查看当前任务任然没有打卡的员工，以及未打卡员工总人数 |

​	4.统计某个任务的打卡总人数

| 请求方式 | get                               |
| :------: | --------------------------------- |
|   url    | /attend/taskAccountCount/{taskId} |
|   参数   | taskid                            |
|   说明   | 统计某一时间段打卡人数,以及总人数 |

#### 4,打卡结果分析模块

打卡结果分析模块主要认为两个接口，一个是生成对应的打卡结果记录，和根据任务id获取打卡统计信息

 	1.根据任务id生成打卡结果

| 请求方式 | get                                                          |
| :------: | ------------------------------------------------------------ |
|   url    | /attendStatus/count/{taskid}                                 |
|   参数   | taskid                                                       |
|   说明   | 分析员工的打卡记录之后共有五种可能出现的结果状态（ 1.正常，2.早退，3.迟到，4.缺勤5.异地打卡）正常：员工在开始和结束时间都有打卡 早退： 员工在结束时期的打卡记录没有。3.迟到：员工在开始时期的打卡记录没有4,缺勤:员工在结束和开始区间内都没有对应的打卡记录5，异地：员工没有在指定的地点进行打卡 |

2.根据任务id获取打卡打卡统计信息

| 请求方式 | get                                                 |
| :------: | --------------------------------------------------- |
|   url    | /attendStatus/attendStatusList/{taskid}             |
|   参数   | taskid                                              |
|   说明   | 根据任务id获取打卡打卡统计信息，并在redis当中做缓存 |

### 4.系统部署

 项目部署在centos上 。

ip:101.200.124.155

 admin:root

password :AA201626aa

 采用springboot的方式进行部署	

​	分别部署在8081,8082,8080端口上，使用ngnix进行代理，做负载均衡

数据库：

​	mysql：

​		 101.200.124.155:3307

​		 admin: root

​		password:123456

​	redis： 

​		101.200.124.155：6379



​	